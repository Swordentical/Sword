Financial Visibility, Staff Authority & Audit Logs

Context:
Dental Clinic Management System with strict role-based access and financial integrity rules.

ğŸ‘¥ Staff (Secretary) â€“ Updated Rules
âœ… Staff CAN:

See all patients

Create and edit patient profiles

See patient-level financial status, including:

Total treatment cost

Amount paid

Remaining balance

Create invoices

Record payments

Collect money from patients

Add notes to financial transactions

Staff are operationally responsible for money collection.

âŒ Staff CANNOT:

View financial analytics (daily/monthly/yearly charts)

View or manage clinic-wide financial reports

View or edit expenses history

View income vs outcome summaries

View activity logs

Modify system financial settings

Delete or alter audit logs

Bypass doctorâ€“patient assignment rules

ğŸ‘‘ Admin â€“ Financial Authority

Admin:

Has full access to:

Financial analytics

Reports

Expenses

Income/outcome summaries

Activity logs

Is the only role allowed to:

Modify financial system rules

Manage expense categories

Review all historical changes

ğŸ“œ Mandatory Audit Log System (CRITICAL)
ğŸ”’ Audit Logging Rules

Every financial or critical action MUST be logged permanently.

Logs are:

Append-only

Immutable

Never deletable

Never editable

Visible ONLY to Admin

ğŸ§¾ Actions That MUST Be Logged

Log entries must be created when:

Invoice is created

Payment is added

Payment is edited

Payment is deleted

Invoice amount is modified

Patient balance changes

Lab payment is recorded

Inventory stock is adjusted

Any financial value changes

Any patient reassignment happens

Any appointment reassignment happens

ğŸ“„ Audit Log Record Format

Each log entry must contain:

{
  id: uuid,
  user_id: uuid,
  user_role: 'admin' | 'doctor' | 'staff',
  action_type: 'CREATE' | 'UPDATE' | 'DELETE',
  entity_type: 'invoice' | 'payment' | 'patient' | 'appointment' | 'inventory' | 'lab_case',
  entity_id: uuid,
  previous_value: jsonb | null,
  new_value: jsonb | null,
  description: string,
  timestamp: timestamptz
}

ğŸ§  Example Log Entry

User: Staff (ID: X)
Action: CREATE
Entity: Payment
Amount: 500 USD
Patient: John Doe
Date: 2026-01-21 14:32
Description: â€œRecorded cash payment for zirconia crownâ€

ğŸ§¨ Deletion Rules (VERY IMPORTANT)

Users may delete records they created (invoice/payment/etc.)

Deletion:

Must be soft-delete

Must create a log entry

âŒ Logs themselves can never be deleted

âŒ Logs can never be modified

âŒ Logs can never be hidden from Admin

ğŸ›¡ï¸ Backend Enforcement (Non-Optional)

Logging must happen server-side

Do NOT rely on frontend logging

Use database triggers or backend middleware to:

Capture old + new values

Store logs automatically

ğŸ§  Design Principle

Money without logs = risk.
Logs without deletion = trust.

Build the system as if it will be audited one day.

ğŸ§ª Final Requirement

Before marking the financial module â€œdoneâ€:

Test that:

Staff cannot access analytics

Doctors cannot see othersâ€™ patients

Admin can see full history

No one can delete audit logs

If you want next, I strongly recommend:

ğŸ”¥ Supabase RLS policies for financial tables

ğŸ”¥ PostgreSQL trigger examples for audit logs

ğŸ”¥ Admin-only audit log UI design

ğŸ”¥ Fraud-prevention edge cases